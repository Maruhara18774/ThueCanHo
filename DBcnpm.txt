-- Name: RENTALAPARTMENT
USE RENTALAPARTMENT

-- Các bảng giả dữ liệu profie
CREATE TABLE TAIKHOAN(
	ID_TAIKHOAN INT IDENTITY(1,1) PRIMARY KEY,
	TEN_TAIKHOAN VARCHAR(100) UNIQUE,
	MATKHAU VARCHAR(100),
	ROLE_TAIKHOAN VARCHAR(50)
)

CREATE TABLE THONGTINKHACHHANG(
	ID_TT_TAIKHOAN INT IDENTITY(1,1) PRIMARY KEY,
	TEN_KHACHHANG NVARCHAR(255),
	EMAIL VARCHAR(100),
	PHONE_NUMBER VARCHAR(20),
	MA_GIAYTOTUYTHAN VARCHAR(20),
	LOAI_GIAYTOTUYTHAN NVARCHAR(50),
	QUOCTICH VARCHAR(100),
	GIOITINH NVARCHAR(10),
	ID_TAIKHOAN INT,
	CONSTRAINT FK_THONGTINKHACHHANG_TAIKHOAN FOREIGN KEY(ID_TAIKHOAN) REFERENCES TAIKHOAN (ID_TAIKHOAN),
)
CREATE TABLE THONGTINCHUHO(
	ID_TT_TAIKHOAN INT IDENTITY(1,1) PRIMARY KEY,
	TEN_CHUHO NVARCHAR(255),
	EMAIL VARCHAR(100),
	PHONE_NUMBER VARCHAR(20),
	MA_GIAYTOTUYTHAN VARCHAR(20),
	LOAI_GIAYTOTUYTHAN NVARCHAR(50),
	QUOCTICH VARCHAR(50),
	GIOITINH NVARCHAR(10),
	DIACHI TEXT,
	MASO_THUE VARCHAR(20),
	ID_TAIKHOAN INT,
	CONSTRAINT FK_THONGTINCHUHO_TAIKHOAN FOREIGN KEY(ID_TAIKHOAN) REFERENCES TAIKHOAN (ID_TAIKHOAN),
)




-- Các bảng thật
CREATE TABLE BANGGIA(
	ID_BANGGIA INT IDENTITY(1,1) PRIMARY KEY,
	-- Giá thuê <= 4 ngày 
	MUCGIA_MOT FLOAT,
	-- Giá thuê <= 7 ngày
	MUCGIA_HAI FLOAT,
	-- Giá thuê <= 10 ngày
	MUCGIA_BA FLOAT,
	-- Giá thuê = giá thường - giá KM
	KHUYENMAI FLOAT,
)
CREATE TABLE QUOCGIA(
	ID_QUOCGIA INT IDENTITY(1,1) PRIMARY KEY,
	TEN_QUOCGIA NVARCHAR(100),
)
CREATE TABLE THANHPHO(
	ID_THANHPHO INT IDENTITY(1,1) PRIMARY KEY,
	ID_QUOCGIA INT,
	TEN_THANHPHO NVARCHAR(100),
	CONSTRAINT FK_THANHPHO_QUOCGIA FOREIGN KEY(ID_QUOCGIA) REFERENCES QUOCGIA (ID_QUOCGIA),
)
CREATE TABLE QUAN(
	ID_QUAN INT IDENTITY(1,1) PRIMARY KEY,
	ID_THANHPHO INT,
	TEN_QUAN NVARCHAR(100),
)
CREATE TABLE TRANGTHAINHA(
	ID_TRANGTHAI_NHA INT IDENTITY(1,1) PRIMARY KEY,
	TEN_TRANGTHAI NVARCHAR(100),
)
CREATE TABLE LOAINHA(
	ID_LOAINHA INT IDENTITY(1,1) PRIMARY KEY,
	TEN_LOAINHA NVARCHAR(100),
)
CREATE TABLE NHA(
	THUTU_NHA INT IDENTITY(1,1) UNIQUE,
	ID_NHA VARCHAR(50) PRIMARY KEY,
	-- link tới tài khoản chủ nhà
	ID_TAIKHOAN INT,
	ID_LOAINHA INT,
	TEN_NHA NVARCHAR(150),
	FREE_CANCEL BIT,
	CHECKIN VARCHAR(5),
	CHECKOUT VARCHAR(5),
	KHOANGCACH_TRUNGTAMTP FLOAT,
	SOTANG TINYINT,
	PHUPHI_BUASANG FLOAT,
	SONHA NVARCHAR(150),
	TEN_DUONG NVARCHAR(100),
	DIENTICH FLOAT,
	ID_QUAN INT,
	SO_NGUOI INT,
	SO_GIUONGPHU INT,
	ID_BANGGIA INT,
	ID_TRANGTHAI_NHA INT,
	CONSTRAINT FK_NHA_BANGGIA FOREIGN KEY(ID_BANGGIA) REFERENCES BANGGIA (ID_BANGGIA),
	CONSTRAINT FK_NHA_TAIKHOAN FOREIGN KEY(ID_TAIKHOAN) REFERENCES TAIKHOAN (ID_TAIKHOAN),
	CONSTRAINT FK_NHA_LOAINHA FOREIGN KEY(ID_LOAINHA) REFERENCES LOAINHA (ID_LOAINHA),
	CONSTRAINT FK_NHA_TRANGTHAINHA FOREIGN KEY(ID_TRANGTHAI_NHA) REFERENCES TRANGTHAINHA (ID_TRANGTHAI_NHA),
)

CREATE TABLE STYLE(
	ID_STYLE INT IDENTITY(1,1) PRIMARY KEY,
	TEN_STYLE NVARCHAR(100)
)

CREATE TABLE STYLENHA(
	ID_STYLENHA INT IDENTITY(1,1) PRIMARY KEY,
	ID_NHA VARCHAR(50),
	ID_STYLE INT,
	CONSTRAINT FK_STYLENHA_NHA FOREIGN KEY(ID_NHA) REFERENCES NHA (ID_NHA),
	CONSTRAINT FK_STYLENHA_STYLE FOREIGN KEY(ID_STYLE) REFERENCES STYLE (ID_STYLE),
)

-- Cơ sở vật chất
CREATE TABLE CSVC(
-- Nếu gộp chung CSVC + chi tiết => Thêm cột thứ tự
	ID_CSVC INT IDENTITY(1,1) PRIMARY KEY,
	TEN_CSVC NVARCHAR(MAX)
	
)

-- Cơ sở vật chất nhà
CREATE TABLE CHITIETCSVC(
	ID_CT_CSVC INT IDENTITY(1,1) PRIMARY KEY,
	ID_CSVC INT,
	TEN_CSVC NVARCHAR(MAX),
	CONSTRAINT FK_CTCSVC_CSVC FOREIGN KEY(ID_CSVC) REFERENCES CSVC (ID_CSVC),
)
CREATE TABLE CSVCNHA(
	ID_CSVC_NHA INT IDENTITY(1,1) PRIMARY KEY,
	ID_CT_CSVC INT,
	ID_NHA VARCHAR(50),
	SOLUONG INT,
	CONSTRAINT FK_CSVCNHA_CHITIETCSVC FOREIGN KEY(ID_CT_CSVC) REFERENCES CHITIETCSVC (ID_CT_CSVC),
)


CREATE TABLE LOAIPHONG(
	ID_LOAIPHONG INT IDENTITY(1,1) PRIMARY KEY,
	TEN_LOAIPHONG NVARCHAR(100),
)

CREATE TABLE LOAIGIUONG(
	ID_LOAIGIUONG INT IDENTITY(1,1) PRIMARY KEY,
	TEN_LOAIGIUONG NVARCHAR(100),
)

CREATE TABLE PHONG(
	ID_PHONG INT IDENTITY(1,1) PRIMARY KEY,
	ID_NHA VARCHAR(50),
	TEN_PHONG NVARCHAR(100),
	ID_LOAIPHONG INT,
	ID_LOAIGIUONG INT,
	SOGIUONG SMALLINT,
	SONGUOITOIDA SMALLINT,
	SOGIUONG_PHU SMALLINT,
	GIAGIUONG_PHU FLOAT,
	CHIEUDAI_PHONG FLOAT,
	CHIEURONG_PHONG FLOAT,
	SOLUONG SMALLINT,
	CONSTRAINT FK_PHONG_NHA FOREIGN KEY(ID_NHA) REFERENCES NHA (ID_NHA),
	CONSTRAINT FK_PHONG_LOAIPHONG FOREIGN KEY(ID_LOAIPHONG) REFERENCES LOAIPHONG (ID_LOAIPHONG),
	CONSTRAINT FK_PHONG_LOAIGIUONG FOREIGN KEY(ID_LOAIGIUONG) REFERENCES LOAIGIUONG (ID_LOAIGIUONG),
)

CREATE TABLE HINHANH(
	ID_HINHANH INT IDENTITY(1,1) PRIMARY KEY,
	ID_PHONG INT,
	HINHANH NVARCHAR(MAX),
	GHICHU TEXT,
	CONSTRAINT FK_HINHANHPHONG_PHONG FOREIGN KEY(ID_PHONG) REFERENCES PHONG (ID_PHONG),
)

-- Nội thất
CREATE TABLE NOITHAT(
	ID_NOITHAT INT IDENTITY(1,1) PRIMARY KEY,
	TEN_NOITHAT NVARCHAR(MAX)
	
)
CREATE TABLE CHITIETNOITHAT(
	ID_CT_NOITHAT INT IDENTITY(1,1) PRIMARY KEY,
	ID_NOITHAT INT,
	TEN_CT NVARCHAR(MAX),
	CONSTRAINT FK_CTNOITHAT_NOITHAT FOREIGN KEY(ID_CT_NOITHAT) REFERENCES NOITHAT (ID_NOITHAT),
)
CREATE TABLE NOITHATPHONG(
	ID_NOITHATPHONG INT IDENTITY(1,1) PRIMARY KEY,
	ID_CT_NOITHAT INT,
	ID_PHONG INT,
	SOLUONG INT,
	CONSTRAINT FK_NOITHATPHONG_CHITIETNOITHAT FOREIGN KEY(ID_CT_NOITHAT) REFERENCES CHITIETNOITHAT (ID_CT_NOITHAT),
	CONSTRAINT FK_NOITHATPHONG_PHONG FOREIGN KEY(ID_PHONG) REFERENCES PHONG (ID_PHONG),
)
CREATE TABLE TRANGTHAIDATCANHO(
	ID_TT_DCH INT IDENTITY(1,1) PRIMARY KEY,
	TEN_TRANGTHAI NVARCHAR(100),
)
CREATE TABLE DATCANHO(
	ID_DATCANHO INT IDENTITY(1,1) PRIMARY KEY,
	ID_NHA VARCHAR(50),
	NGAYDAT VARCHAR(20),
	CHECKIN VARCHAR(5),
	CHECKOUT VARCHAR(5),
	TONGTIEN_PHONG FLOAT,
	BUASANG INT,
	TONGTIEN_BUASANG FLOAT,
	SO_GIUONGPHU SMALLINT,
	TONGTIEN_GIUONGPHU FLOAT,
	PHI_GTGT FLOAT,
	TONGTIEN FLOAT,
	GHICHU TEXT,
	ID_TT_DCH INT,
	CONSTRAINT FK_DATCANHO_NHA FOREIGN KEY(ID_NHA) REFERENCES NHA (ID_NHA),
	CONSTRAINT FK_DATCANHO_TRANGTHAIDATCANHO FOREIGN KEY(ID_TT_DCH) REFERENCES TRANGTHAIDATCANHO (ID_TT_DCH),
)

CREATE TABLE DANHGIA(
	ID_DANHGIA INT IDENTITY(1,1) PRIMARY KEY,
	ID_TAIKHOAN INT,
	THUTU_NHA INT,
	SOSAO SMALLINT,
	NOIDUNG TEXT,
	CONSTRAINT FK_DANHGIA_TAIKHOAN FOREIGN KEY(ID_TAIKHOAN) REFERENCES TAIKHOAN (ID_TAIKHOAN),
	CONSTRAINT FK_DANHGIA_NHA FOREIGN KEY(THUTU_NHA) REFERENCES NHA (THUTU_NHA),
)


-- Fake data
INSERT INTO TAIKHOAN(TEN_TAIKHOAN,MATKHAU,ROLE_TAIKHOAN)
VALUES 
('chung','chung','Customer'),
('trucquynh22','123456','Partner'),
('tantran45','123456','Customer'),
('nguyenha50','123456','Admin');

INSERT INTO THONGTINCHUHO(TEN_CHUHO,EMAIL,PHONE_NUMBER, MA_GIAYTOTUYTHAN, LOAI_GIAYTOTUYTHAN, QUOCTICH, GIOITINH, DIACHI, MASO_THUE, ID_TAIKHOAN)
VALUES 
(N'Nguyễn Văn A','nguyenA@gmail.com','012353554','24522565','CCCD','Vietnam',N'Nam','145 Vân Đồn, LX','26524875',2);

INSERT INTO THONGTINKHACHHANG(TEN_KHACHHANG,EMAIL,PHONE_NUMBER, MA_GIAYTOTUYTHAN, LOAI_GIAYTOTUYTHAN, QUOCTICH, GIOITINH, ID_TAIKHOAN)
VALUES
(N'Trịnh Vân','vantrinh@gmail.com','012353554','24522565','CCCD','Vietnam',N'Nữ',3);

INSERT INTO BANGGIA(MUCGIA_MOT,MUCGIA_HAI,MUCGIA_BA)
VALUES
(260000,250000,230000),
(370000,300000,270000)

INSERT INTO LOAINHA(TEN_LOAINHA)
VALUES
(N'Biệt thự'),
(N'Căn hộ'),
(N'Homestay');

INSERT INTO NHA(ID_NHA,ID_TAIKHOAN,ID_LOAINHA,TEN_NHA,FREE_CANCEL,CHECKIN,CHECKOUT,KHOANGCACH_TRUNGTAMTP,SOTANG,PHUPHI_BUASANG,SONHA, TEN_DUONG, ID_QUAN, SO_NGUOI, SO_GIUONGPHU, ID_BANGGIA)
VALUES
('APART0001',2,2,N'Căn hộ hướng Bitexco',0,'09:20','17:00',1500,1,50000,N'22/44/66',N'Nguyễn Duệ',1,10,2,1),
('VILLA0002',2,1,N'Biệt thự hướng sông Sài Gòn',1,'09:00','17:40',200,2,70000,N'12/8',N'Trần Nhật Duật',1,20,4,2);

INSERT INTO CSVC(TEN_CSVC)
VALUES
(N'Chung'),
(N'Kết nối'),
(N'Cơ sở vật chất'),
(N'Dịch vụ')

INSERT INTO CHITIETCSVC(ID_CSVC,TEN_CSVC)
VALUES
(1,'Bãi đậu xe'),
(1, 'Két an toàn'),
(1, 'Quán cafe'),
(1, 'Nhà hàng'),
(2, 'Wifi tính phí'),
(2, 'Wifi miễn phí'),
(2, 'Cuộc gọi quốc tế'),
(3,'Khu vực hút thuốc'),
(3,'Điều hòa nhiệt độ'),
(3,'Tủ đồ'),
(4,'Lễ tân'),
(4,'Dịch vụ giặt ủi');
